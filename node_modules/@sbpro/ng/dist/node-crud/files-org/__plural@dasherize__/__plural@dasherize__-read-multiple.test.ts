import { mockFind<%= classify(plural) %> } from '@mocks/@app/routes/_shared';
import {
    mockFastifyInstanceParameter,
    MockFastifyReply,
    mockGenerateError,
    mockReply,
    mockRoute,
    requestMockWithParams,
} from '@mocks/fastify';
import {
    OrgIDParam,
    ReadMultiple<%= classify(plural) %>Payload,
    TestOrgIDParam,
    TestReadMultiple<%= classify(plural) %>Payload,
    TestResults<%= classify(name) %>,
} from '@start-bootstrap/website-shared-types';
import { Test<%= classify(name) %> } from '@testing/objects';
import { FastifyRequest } from 'fastify';

import { handler, <%= camelize(plural) %>ReadMultiple } from './<%= dasherize(plural) %>-read-multiple';

describe('<%= classify(plural) %>ReadMultiple', () => {
    beforeEach(() => {
        mockFind<%= classify(plural) %>.mockReset();
        mockGenerateError.mockReset();
        (requestMockWithParams as FastifyRequest<{
            Params: OrgIDParam;
            Body: ReadMultiple<%= classify(plural) %>Payload;
        }>).params = new TestOrgIDParam();
        (requestMockWithParams as FastifyRequest<{
            Params: OrgIDParam;
            Body: ReadMultiple<%= classify(plural) %>Payload;
        }>).body = new TestReadMultiple<%= classify(plural) %>Payload();
    });

    it('should create the <%= camelize(plural) %>Read route', async () => {
        <%= camelize(plural) %>ReadMultiple(mockFastifyInstanceParameter, {}, () => {});
        expect(mockRoute).toHaveBeenCalled();
    });
    it('should return the <%= camelize(plural) %>', async () => {
        mockFind<%= classify(plural) %>.mockImplementation(() => [new Test<%= classify(name) %>()]);
        const returnValue = await handler.call(
            mockFastifyInstanceParameter,
            requestMockWithParams as FastifyRequest<{
                Params: OrgIDParam;
                Body: ReadMultiple<%= classify(plural) %>Payload;
            }>,
            mockReply as MockFastifyReply<{ Params: OrgIDParam; Body: ReadMultiple<%= classify(plural) %>Payload }>
        );
        expect(mockFind<%= classify(plural) %>).toHaveBeenCalled();
        expect(returnValue).toEqual([new TestResults<%= classify(name) %>()]);
    });
});
